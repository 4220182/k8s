---
# Source: emissary-ingress/templates/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: emissary-ingress-cluster
  namespace: emissary
  labels:
    app.kubernetes.io/component: ambassador-service
    product: aes
  annotations:
    a8r.io/owner: Ambassador Labs
    a8r.io/repository: github.com/datawire/ambassador
    a8r.io/description: The Ambassador Edge Stack goes beyond traditional API Gateways
      and Ingress Controllers with the advanced edge features needed to support developer
      self-service and full-cycle development.
    a8r.io/documentation: https://www.getambassador.io/docs/edge-stack/latest/
    a8r.io/chat: http://a8r.io/Slack
    a8r.io/bugs: https://github.com/datawire/ambassador/issues
    a8r.io/support: https://www.getambassador.io/about-us/support/
    a8r.io/dependencies: emissary-ingress-redis.emissary
spec:
  type: ClusterIP
  ports:
  - name: http
    port: 80
    targetPort: 8888
  - name: https
    port: 443
    targetPort: 9999
  selector:
    service: ambassador
    profile: main
---
apiVersion: x.getambassador.io/v3alpha1
kind: AmbassadorListener
metadata:
  name: http-listener-8888
spec:
  port: 8888
  protocol: HTTP  # NOT A TYPO, see below
  securityModel: XFP
  hostBinding:
    namespace:
      from: SELF   # See below
---
apiVersion: x.getambassador.io/v3alpha1
kind: AmbassadorListener
metadata:
  name: https-listener-9999
spec:
  port: 9999
  protocol: HTTPS
  securityModel: XFP
  hostBinding:
    namespace:
      from: SELF   # See below
---
apiVersion: getambassador.io/v2
kind:  TLSContext
metadata:
  name:  h2-tls-tmp
spec:
  secret: h2-certs
  hosts: ["*"]
  alpn_protocols: h2, http/1.1
---
apiVersion: x.getambassador.io/v3alpha1
kind: AmbassadorHost
metadata:
  name: tmp.com-host
spec:
  hostname: "*.tmp.com"
  acmeProvider:
    authority: none
  tlsSecret:
    name: h2-tls-tmp
  tlsSecret: 
    name: tls-cert
  requestPolicy:
    insecure:
      action: Route
---
apiVersion: x.getambassador.io/v3alpha1
kind:  AmbassadorMapping
metadata:
  name:  h9-mapping
spec:
  prefix: /
  service: nginx:80
  host: h9.tmp.com
